---
title: "必須のPSQLコマンド | PostgreSQL"
description: "この記事では、PostgreSQLデータベースを扱う際に知っておくべきpsqlコマンドについて説明します。"
image: "/blog/image/11.png"
category: "Tips"
date: October 12, 2024
---

# 必須のPSQLコマンド | PostgreSQL

PostgreSQL、または略してPostgresは、SQL言語を使用するオブジェクト指向リレーショナルデータベース管理システムです。無料でオープンソースであり、信頼性が高く、パワフルで効率的な性能を持っています。PostgreSQLは最も人気があり、広く使用されているリレーショナルデータベースの一つでもあります。

psqlは、ターミナルを通じてPostgresデータベースと対話できるコマンドラインツールです。これを使用すると、データベースに接続したり、データを追加・読み取り・変更したり、データベースやフィールドを表示したり、ファイルからのコマンドを実行したりすることができます。

Postgresのコマンドを学びたい場合や、知識を更新したい場合は、ここが正しい場所です！この記事では、PostgreSQLで作業する際に最も重要なpsqlコマンドとオプションについて紹介します。

![psql](/image/blog/psql/1.png)

## 1. データベースに接続 `psql -d`

最初のステップは、データベースへの接続方法を学ぶことです。データベースの位置によって2つの接続方法があります。

### 同一ホスト上のデータベース

データベースが同じホストにある場合、以下のコマンドを使用して接続できます：

```SQL
psql -d <db-name> -U <username> -W

// 例
psql -d ali_test_demo -U admin -W
```

上記のコマンドには3つのパラメータがあります：

- `-d` は接続するデータベース名を指定するために使用されます。
- `-U` は使用するユーザー名を指定するために使用されます。
- `-W` はデータベースに接続する前にパスワードの入力を強制するために使用されます。

この例では、コマンドはadminユーザーとしてali_test_demoデータベースに接続します。

### 別のホスト上のデータベース

データベースが他の場所にある場合、以下のようになります：

```SQL
psql -h <db-address> -d <db-name> -U <username> -W

// 例
psql -h localhost -d ali_test_demo -U admin -W
```

`-h` フラグはデータベースのホストアドレスを指定します。

### SSLモード

時にはSSLを使用して接続することも必要になるかもしれません：

```Plain
psql "sslmode=require host=<db-address> dbname=<db-name> user=<username>"

// 例
psql "sslmode=require host=my-psql-db.cloud.tech dbname=ali_test_demo user=admin"
```

上記のコマンドは、指定されたデータベースに対するSSL接続を開きます。

## 2. すべてのデータベースをリストする `- \l`

多くの場合、複数のデータベースを扱うことがあります。次のコマンドを使用して利用可能なすべてのデータベースを表示できます：

```SQL
postgres=# \l
                             データベースの一覧
   名前        |  所有者  | エンコーディング |   コラテーション   |    Ctype    |   アクセス権限   |  サイズ   | テーブルスペース 
   ------------+---------+----------+-------------+-------------+-----------------------+---------+-------------
 customer_data | dbadmin | UTF8     | en_US.UTF-8 | en_US.UTF-8 |                       | 512 MB  | pg_default
 employees     | dbadmin | UTF8     | en_US.UTF-8 | en_US.UTF-8 |                       | 300 MB  | pg_default
 inventory     | dbadmin | UTF8     | en_US.UTF-8 | en_US.UTF-8 |                       | 1 GB    | pg_default
 template0     | postgres| UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +| 3276 kB | pg_default
 template1     | postgres| UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +| 3276 kB | pg_default
(5 行)
```

上記の画像はコマンドを実行した際の様子を示しています。あなたは名前、所有者、アクセス権限などの情報を持つすべてのデータベースのテーブルを得ます。

## 3. 他のデータベースに切り替える `- \c`

以下のようなコマンドを使用して他のデータベースに切り替えることもできます：

```SQL
\c <db-name>

// 例
\c sy_test_db
```

例えば：

```SQL
postgres=# \c sy_test_db
あなたは現在"sy_test_db"データベースに"postgres"ユーザーとして接続しています
sy_test_db=# 
```

このコマンドは以前にログインしたユーザーの下で指定されたデータベースに切り替えます。

## 4. データベースのテーブルをリストする `- \dt`

データベース内のすべてのテーブルを見たいと考えている場合、以下のようになります：

```SQL
sy_test_db=# \dt
            リレーションの一覧
スキーマ |       名前        | タイプ  | 所有者
-------+-------------------+-------+-------
public  |     users        | table | postgres
public  |     orders       | table | postgres
public  |     products     | table | postgres
(3 行)
```

`\dt` psqlコマンドはテーブルに関する以下の情報を返します：

- テーブルが属するスキーマ
- テーブルのタイプ
- テーブルの所有者

## 5. テーブルの説明 `- \d`

psqlにはテーブルの構造を見るためのコマンドもあります。

```Plain
\d <table-name>

// 例
\d ali_test_db
```

`\d` コマンドはテーブルのすべての列、それらのデータ型、インデックス、NULLの許可、設定されたデフォルト値を返します。

より詳しい情報を得たい場合、以下のコマンドを使用できます：

```SQL
\d+ <table-name>
ali_test_db=# \d+ employees
                    テーブル "public.employees"
列   |      型             | コラテーション | Nullable | デフォルト | ストレージ  | 統計目標 | 説明 
---------+-----------------------+-----------+----------+---------+----------+--------------+--------------
id       |       integer         |           | not null | nextval('employees_id_seq'::regclass) | plain |
name     | character varying(50) |           |          | extended | 
age      |       smallint        |           |          | plain    | 
email    | character varying(100)|           | not null | extended | 
position | character varying(50) |           |          | extended | 
salary   |    numeric(10,2)      |           |          | main     | 

インデックス:
    "employees_pkey" PRIMARY KEY, btree (id)

アクセス方法: heap
```

これにより、ストレージ、圧縮、統計目標、説明などの追加情報が得られます。

## 6. すべてのスキーマをリストする `- \dn`

`\dn` psqlコマンドはすべてのデータベーススキーマをリストします。それはスキーマの名前とその所有者を返します。

```SQL
\dn
```

## 7. ユーザーとロールをリストする `- \du`

時々ユーザーを変更する必要があるかもしれません。Postgresにはすべてのユーザーとそのロールをリストするコマンドがあります。

```SQL
\du
postgres=# \du
ロール名        | 属性 | 所属
-----------------+------------+----------
postgres         | Superuser, Create role, Create DB, Replication, Bypass RLS | {}
ali_demo1        |     {}     | {}
```

## 8. 特定のユーザーを取得する `- \du`

以下のようなコマンドを使用して特定のユーザーに関する情報を取得することもできます：

```SQL
\du <username>

// 例
\du postgres
```

これにより、指定されたユーザーのロールとユーザーがグループのメンバーであるかどうかを確認できます。

```SQL
ali_test_db=# \du postgres
ロール名 | 属性 | 所属
----------+------------+----------
postgres | Superuser, Create role, Create DB, Replication, Bypass RLS | {}
```

## 9. すべての関数をリストする `- \df`

`\df` コマンドを使用してデータベース内のすべての関数をリストし、以下の情報を取得できます：

- 関数が属するスキーマ
- 関数の名前
- 関数によって返される結果のデータ型
- 関数のパラメータのデータ型
- 関数のタイプ

これにより、データベース内で定義されているすべての関数とその詳細を確認できます。

## 10. すべてのビューをリストする `- \dv`

psqlインターフェイスでは、`\dv` コマンドを使用してすべてのデータベースビューをリストできます。

## 11. クエリ結果をファイルに保存する `- \o`

時には後でクエリ結果を分析するか、2つのクエリの結果を比較したい場合があります。psqlインターフェイスではこれを行うことができます。次のようにクエリ結果をファイルに保存できます：

```Plain
\o <file-name>
// 例
\o query_results
...psql コマンドを実行...
\o - プロセスを停止し、再度結果をターミナルに出力する
```

以下のクエリ結果をファイルに保存しましょう：

- 利用可能なデータベーステーブル
- データベーステーブルを説明する結果
- すべてのユーザーのリスト
- ユーザー "postgres" の詳細

![psql](/image/blog/psql/2.png)

> 注意：ファイルへの結果の保存を停止するには、再度 `\o` コマンド（ファイル名なし）を実行する必要があります。

## 12. ファイルからコマンドを実行する `- \i`

また、ファイルからコマンドを実行することもできます。単純なコマンドに対してはこれが最善の選択肢ではないかもしれませんが、複数のコマンドや複雑なSQLステートメントを実行する必要がある場合には非常に便利です。

以下の内容を持つテキストファイルを作成してください：

```Plain
\l
\dt
\du
```

このファイルを実行すると、以下のリストが返されます：

- データベース
- データベーステーブル
- ユーザー

以下のpsqlコマンドを使用して、これらのコマンドをファイルから実行できます：

```Plain
\i <file-name>

// 例
\i psql_commands.txt
```

![psql](/image/blog/psql/3.png)

コマンドは期待通りにすべてのデータベース、テーブル、ユーザーを返します。

## 13. psqlを終了する `- \q`

`\q` コマンドを使用してpsqlインターフェイスを終了できます。

## まとめ

psqlインターフェイスは強力で、さまざまな操作を行うための豊富な機能を提供しています。これにはSQLステートメントの実行、データベースの管理、データのクエリなどが含まれます。psqlを使用すると、PostgreSQLデータベースに簡単に接続し、テーブルを作成・変更し、データの挿入・更新を行い、複雑なクエリを実行することができます。

PostgreSQLを使用を開始したい、またはその機能を深く理解したい場合は、[公式ウェブサイト](https://www.postgresql.org/docs/)を訪問することをお勧めします。ウェブサイトでは、詳細なドキュメンテーション、チュートリアル、そして例が提供されており、PostgreSQLの使用をより良くマスターするのに役立ちます。

## Chat2DB Proの体験を始めましょう

強力でAIベースのデータベース管理ツールをお探しの方は、ぜひChat2DBをご試用ください！データベース管理者、開発者、データアナリストを問わず、Chat2DBはAIの強力な機能を活用してあなたの仕事を簡略化します。

👉[今すぐChat2DB Proの30日間無料トライアルを体験](https://chat2db.ai/pricing)、全てのプレミアム機能をお楽しみください。
